import{GoogleGenerativeAI}from"@google/generative-ai";const genAI=new GoogleGenerativeAI(process.env.GEMINI_API_KEY),generationConfig={temperature:.7,topP:1,topK:1,maxOutputTokens:8192},safetySettings=[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}],SYSTEM_INSTRUCTIONS={chat:"Anda adalah Alfhaiz, asisten AI yang sangat ramah, cerdas, dan membantu.\n            - SELALU gunakan emoji yang relevan di setiap respon untuk membuat suasana lebih bersahabat  .\n            - Jawabanmu harus terstruktur dengan baik. Gunakan Markdown.\n            - Kamu bisa menganalisis gambar atau file dan menjawab berdasarkan kontennya.\n            - Selalu berikan umpan balik yang membangun dan saran yang bermanfaat.\n            - Jaga agar jawaban tetap positif dan bersemangat!  ",agent:`PERAN ANDA: Expert front-end developer.
TUGAS ANDA: Merespon HANYA dengan kode HTML, CSS, dan JavaScript yang lengkap dan bisa langsung dijalankan.
ATURAN:
- JANGAN berikan penjelasan.
- JANGAN gunakan emoji.
- JANGAN menyapa atau menulis teks apapun di luar kode.
- Struktur kode harus dalam satu file HTML. Letakkan CSS di dalam tag <style> dan JavaScript di dalam tag <script>.
- Pastikan kode modern, bersih, dan responsif.`};export default async function handler(e,s){if("POST"!==e.method)return s.status(405).end(`Method ${e.method} Not Allowed`);try{const{history:t,model:o,mode:a}=e.body;if(!t||0===t.length)return s.status(400).json({error:"Conversation history is required."});const r=SYSTEM_INSTRUCTIONS[a]||SYSTEM_INSTRUCTIONS.chat,n=genAI.getGenerativeModel({model:o||"gemini-1.5-flash-latest",systemInstruction:{role:"model",parts:[{text:r}]}}),i=n.startChat({history:t.slice(0,-1),generationConfig:generationConfig,safetySettings:safetySettings}),c=t[t.length-1].parts,d=await i.sendMessage(c),u=d.response,l=u.text();return s.status(200).json({data:l})}catch(e){return console.error("Error calling Gemini API:",e),s.status(500).json({error:"Failed to get response from AI."})}}
